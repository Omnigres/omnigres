$schema: "https://raw.githubusercontent.com/omnigres/omnigres/master/pg_yregress/schema.json"
instance:
  init:
    - create extension omni_schema cascade
    - create schema test
    - create table test.empty_table ();
    - create view test.empty_view as select * from test.empty_table;
    - create materialized view test.empty_materialized_view as select * from test.empty_table;

tests:

- name: created table shows up with expected values
  steps:
    - query: select id, table_id, schema_name, table_name, role_id, role_name, type, is_grantable, with_hierarchy from omni_schema.table_privilege where table_id = omni_schema.relation_id('test', 'empty_table') order by id;
      results:
      - id: "(test,empty_table,yregress,DELETE)"
        table_id: "(test,empty_table)"
        schema_name: test
        table_name: empty_table
        role_id: (yregress)
        role_name: yregress
        type: DELETE
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_table,yregress,INSERT)"
        table_id: "(test,empty_table)"
        schema_name: test
        table_name: empty_table
        role_id: (yregress)
        role_name: yregress
        type: INSERT
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_table,yregress,REFERENCES)"
        table_id: "(test,empty_table)"
        schema_name: test
        table_name: empty_table
        role_id: (yregress)
        role_name: yregress
        type: REFERENCES
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_table,yregress,SELECT)"
        table_id: "(test,empty_table)"
        schema_name: test
        table_name: empty_table
        role_id: (yregress)
        role_name: yregress
        type: SELECT
        is_grantable: true
        with_hierarchy: true
      - id: "(test,empty_table,yregress,TRIGGER)"
        table_id: "(test,empty_table)"
        schema_name: test
        table_name: empty_table
        role_id: (yregress)
        role_name: yregress
        type: TRIGGER
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_table,yregress,TRUNCATE)"
        table_id: "(test,empty_table)"
        schema_name: test
        table_name: empty_table
        role_id: (yregress)
        role_name: yregress
        type: TRUNCATE
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_table,yregress,UPDATE)"
        table_id: "(test,empty_table)"
        schema_name: test
        table_name: empty_table
        role_id: (yregress)
        role_name: yregress
        type: UPDATE
        is_grantable: true
        with_hierarchy: false   

- name: created view shows up with expected values
  steps:
    - query: select id, table_id, schema_name, table_name, role_id, role_name, type, is_grantable, with_hierarchy from omni_schema.table_privilege where table_id = omni_schema.relation_id('test', 'empty_view') order by id;
      results:
      - id: "(test,empty_view,yregress,DELETE)"
        table_id: "(test,empty_view)"
        schema_name: test
        table_name: empty_view
        role_id: (yregress)
        role_name: yregress
        type: DELETE
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_view,yregress,INSERT)"
        table_id: "(test,empty_view)"
        schema_name: test
        table_name: empty_view
        role_id: (yregress)
        role_name: yregress
        type: INSERT
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_view,yregress,REFERENCES)"
        table_id: "(test,empty_view)"
        schema_name: test
        table_name: empty_view
        role_id: (yregress)
        role_name: yregress
        type: REFERENCES
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_view,yregress,SELECT)"
        table_id: "(test,empty_view)"
        schema_name: test
        table_name: empty_view
        role_id: (yregress)
        role_name: yregress
        type: SELECT
        is_grantable: true
        with_hierarchy: true
      - id: "(test,empty_view,yregress,TRIGGER)"
        table_id: "(test,empty_view)"
        schema_name: test
        table_name: empty_view
        role_id: (yregress)
        role_name: yregress
        type: TRIGGER
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_view,yregress,TRUNCATE)"
        table_id: "(test,empty_view)"
        schema_name: test
        table_name: empty_view
        role_id: (yregress)
        role_name: yregress
        type: TRUNCATE
        is_grantable: true
        with_hierarchy: false
      - id: "(test,empty_view,yregress,UPDATE)"
        table_id: "(test,empty_view)"
        schema_name: test
        table_name: empty_view
        role_id: (yregress)
        role_name: yregress
        type: UPDATE
        is_grantable: true
        with_hierarchy: false   

- name: created materialized view does not show up
  steps:
    - query: select id, table_id, schema_name, table_name, role_id, role_name, type, is_grantable, with_hierarchy from omni_schema.table_privilege where table_id = omni_schema.relation_id('test', 'empty_materialized_view') order by id;
      results: []
